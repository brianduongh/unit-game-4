<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Pokemon!</title>
  <link rel="stylesheet" type="text/css" href="assets/css/reset.css">
  <link rel="stylesheet" type="text/css" href="assets/css/style.css">
  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
</head>
<body>
  <div class="flex">
    <div class="container">
      <h1>Choose a starter pokemon!</h1>
      <div class="flex" id="pokemons"></div>
      <div id="selectedPokemon">Pokemon selected</div>
      <div class="flex" id="otherPokemons">[other pokemon]</div>
      <div>enemy pokemon</div>
      <div id="enemyPokemon">fight enemy pokemon here</div>
      <button id="attackBtn">Attack</button>
      <button id="restartBtn">Restart</button>
    </div>
  </div>

  <script type="text/javascript">
    $(document).ready(function() {
      var pokemons = [
        {
          name: "Pikachu",
          hp: 100,
          atkPower: 2,
          defAtkPower: 2,
          counterPower: 20,
          imgSrc: 'https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/25.png'
        },
        {
          name: "Bulbasaur",
          hp: 110,
          atkPower: 6,
          defAtkPower: 6,
          counterPower: 5,
          imgSrc: 'https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/1.png'
        },
        {
          name: "Charmander",
          hp: 120,
          atkPower: 5,
          defAtkPower: 5,
          counterPower: 15,
          imgSrc: 'https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/4.png'
        },
        {
          name: "Squirtle",
          hp: 130,
          atkPower: 4,
          defAtkPower: 4,
          counterPower: 10,
          imgSrc: 'https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/7.png'
        }
      ];


      // Declared variables
      var choosePokemon = [];
      var chosenPokemon = {};
      var enemyPokemon = {};
      var pokemonSelected = false;
      var enemySelected = false;

      // Start a new game
      function newGame() {

        choosePokemon = [...pokemons];
        generatePokemon(pokemons);
        console.log(pokemons);
        console.log(choosePokemon);
      };

      function resetGame() {
        $("#pokemons").empty();
        $("#selectedPokemon").empty();
        $("#enemyPokemon").empty();
        $("#otherPokemons").empty();
        choosePokemon = [...pokemons];
        generatePokemon(pokemons);
        chosenPokemon = {};
        enemyPokemon = {};
        pokemonSelected = false;
        enemySelected = false;
        console.log(pokemons);
        console.log(choosePokemon);
      };


      // Generate pokemon images
      function generatePokemon(pokemonList) {
        for (var i=0; i < pokemonList.length; i++) {
          var pokeCard = $("<div>").addClass("pokemon");
          pokeCard.attr({
            "id": pokemonList[i].name,
            "key": i
          });
          var sprite = $("<img>");
          sprite.attr("src", pokemonList[i].imgSrc);
          pokeCard.append(sprite);
          $("#pokemons").append(pokeCard);
        }
      }
      newGame();


      // Choose pokemon
      $(document).on("click", ".pokemon", function() {
        var pokemonId = $(this).attr("key");
        // User picks pokemon
        if (!pokemonSelected && !enemySelected) {
          // Sets chosen pokemon
          chosenPokemon = choosePokemon[pokemonId];
          console.log(choosePokemon);
          pokemonSelected = true;
          // Testing
          var pokemonCard = ($("<div>")).addClass("playerPokemon");
          var pokeImg = $("<img>");
          var pokeHp = $("<p>" + chosenPokemon.hp + "</p>")
          pokeHp.attr("id", "pokeHp");
          pokeImg.attr("src", chosenPokemon.imgSrc);
          pokemonCard.append(pokeImg).append(pokeHp);
          pokemonCard.appendTo("#selectedPokemon");
          $("#pokemons").contents().appendTo("#otherPokemons");

          // Remove Pokemon from array
          $("#" + chosenPokemon.name).remove();

        } else if (pokemonSelected && !enemySelected) {
          // Sets enemy pokemon and moves to enemy div
          enemyPokemon = choosePokemon[pokemonId];
          // $("#" + enemyPokemon.name).appendTo("#enemyPokemon");
          enemySelected = true;
          var enemyCard = ($("<div>")).addClass("enemyPokemon");
          var enemyImg = $("<img>");
          var enemyHp = $("<p>" + enemyPokemon.hp + "</p>")
          enemyHp.attr("id", "enemyHp");
          enemyImg.attr("src", enemyPokemon.imgSrc);
          enemyCard.append(enemyImg).append(enemyHp);
          enemyCard.appendTo("#enemyPokemon");
          $("#" + enemyPokemon.name).remove();
        }
      })


      // Attack pokemon
      $("#attackBtn").on("click", function() {
        if (pokemonSelected && enemySelected) {
          // When user attacks, decrease enemyPokemon hp and increase atk power
          enemyPokemon.hp -= chosenPokemon.atkPower
          chosenPokemon.hp -= enemyPokemon.atkPower;
          chosenPokemon.atkPower += chosenPokemon.defAtkPower;
          // Update hp of pokemon
          $("#pokeHp").text(chosenPokemon.hp);
          $("#enemyHp").text(enemyPokemon.hp);
          checkHp();
          console.log(pokemons);
          console.log(choosePokemon);
        }
      });

      function checkHp() {
        if (chosenPokemon.hp <= 0) {
          alert("you lose!")
        } else if (enemyPokemon.hp <= 0) {
          $("#enemyPokemon").empty();
          // Allows user to select new enemy and resets enemy
          enemyPokemon = {};
          enemySelected = false;
        }
      };

      $("#restartBtn").on("click", function() {
        resetGame();
      })

    });
  </script>
</body>
</html>
