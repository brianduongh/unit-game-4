<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Pokemon!</title>
  <link rel="stylesheet" type="text/css" href="assets/css/reset.css">
  <link rel="stylesheet" type="text/css" href="assets/css/style.css">
  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
</head>
<body>
  <p>Choose a pokemon!</p>
  <div id="pokemons"></div>
  <div id="selectedPokemon">Pokemon selected</div>
  <div id="otherPokemons">[other pokemon]</div>
  <div id="enemyPokemon">fight enemy pokemon here</div>
  <button id="attackBtn">Attack</button>
  <button id="restartBtn">Restart</button>

  <script type="text/javascript">
    $(document).ready(function() {
      var pokemons = [
        {
          name: "Pikachu",
          hp: 22,
          atkPower: 2,
          defAtkPower: 2,
          counterPower: 2,
          imgSrc: 'https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/25.png'
        },
        {
          name: "Bulbasaur",
          hp: 25,
          atkPower: 2,
          defAtkPower: 2,
          counterPower: 2,
          imgSrc: 'https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/1.png'
        },
        {
          name: "Charmander",
          hp: 28,
          atkPower: 1,
          defAtkPower: 1,
          counterPower: 2,
          imgSrc: 'https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/4.png'
        },
        {
          name: "Squirtle",
          hp: 30,
          atkPower: 4,
          defAtkPower: 1,
          counterPower: 2,
          imgSrc: 'https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/7.png'
        }
      ];

      // Declared variables
      var choosePokemon = [];
      var choosenPokemon = {
        // name: "Squirtle",
        // hp: 30,
        // atkPower: 4,
        // defAtkPower: 4,
        // counterPower: 2,
        // imgSrc: 'https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/7.png'
      };
      var enemyPokemon = {
        name: "Charmander",
        hp: 28,
        atkPower: 1,
        defAtkPower: 1,
        counterPower: 2,
        imgSrc: 'https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/4.png'
      };
      var pokemonSelected = false;
      var enemySelected = false;
      var selectEnemy = false;

      // On click events
      $("#attackBtn").on("click", function() {
        attack();
      });

      // On attack
      function attack() {
        console.log(choosenPokemon);
          // hp calculation
          choosenPokemon.hp = choosenPokemon.hp - enemyPokemon.atkPower;
          enemyPokemon.hp = enemyPokemon.hp - choosenPokemon.atkPower;
          // dmg calculation
          choosenPokemon.atkPower = choosenPokemon.atkPower + choosenPokemon.defAtkPower;
          // console.log(choosenPokemon.atkPower + choosenPokemon.defAtkPower);

          // if enemy hp reaches 0, remove from enemyPokemon
          if (enemyPokemon.hp <= 0) {
            alert("you killed enemy!");
            enemySelected = false;
          // if your hp reaches 0, you lose
          } else if (choosenPokemon.hp <= 0) {
            alert("you died!");
          }
          // testing
          console.log("choosen hp" + choosenPokemon.hp);
          console.log("enemy hp" + enemyPokemon.hp)
      }

      // Start a new game
      function newGame() {
        choosePokemon = pokemons;
        console.log(choosePokemon)
        generatePokemon(choosePokemon);
      }

      // Generate pokemon from array
      function generatePokemon(pokemonList) {
        for (var i=0; i < pokemonList.length; i++) {
          var pokeName = $("<div>" + "<img src=" + pokemonList[i].imgSrc + ">" + "</div>");
          pokeName.addClass("pokemon");
          pokeName.attr({
            "id": pokemonList[i].name,
            "key": i,
            "atk": pokemonList[i].atkPower
          });
          $("#pokemons").append(pokeName);
        }
      };

      newGame();

      // on click pokemon
      $(".pokemon").on("click", function() {
        var pokemonId = $(this).attr("key");
        // User selects pokemon
        if (!pokemonSelected && !enemySelected) {
          choosenPokemon = choosePokemon[pokemonId];
          $("#" + choosenPokemon.name).appendTo("#selectedPokemon");
          $("#pokemons").contents().appendTo("#otherPokemons");
          // $("#otherPokemons").contents().appendTo("#choosePokemons");
          pokemonSelected = true;
        } else if (pokemonSelected && !selectEnemy) {
          enemyPokemon = choosePokemon[pokemonId];
          $("#" + enemyPokemon.name).appendTo("#enemyPokemon");
          enenmySelected = true;
        }
        // choosenPokemon.atkPower++;
        // if (choosenPokemon.atkPower == 10) {
        //   console.log("SHIT");
        // }

        // if (1 == 1) {
        //   choosenPokemon = [...pokemonList[pokemonId]];
        // }
        // Testing key
      });


    });
  </script>
</body>
</html>
